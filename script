--================================================================
-- Lasso Animals - Özel Kodlanmış GUI
--================================================================

-- Servisleri tanımlıyoruz
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- Script'in çalışması için gerekli global değişkenler
_G.AutoBuyTreats = false
_G.WalkSpeed = 16

--================================================================
-- 1. ADIM: GUI ELEMENTLERİNİ OLUŞTURMA
--================================================================

-- Ana GUI konternerı (Tüm arayüzü içinde tutar)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CustomLassoGui"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false -- Karakter ölünce GUI'nin kaybolmasını engeller

-- Ana Pencere (Sürüklenir)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 280, 0, 180)
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 1
MainFrame.BorderColor3 = Color3.fromRGB(80, 80, 90)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner_Main = Instance.new("UICorner")
UICorner_Main.CornerRadius = UDim.new(0, 8)
UICorner_Main.Parent = MainFrame

-- Başlık Çubuğu
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local UICorner_Title = Instance.new("UICorner")
UICorner_Title.CornerRadius = UDim.new(0, 8)
UICorner_Title.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, 0, 1, 0)
TitleLabel.Text = "Lasso Animals Helper"
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextSize = 16
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Parent = TitleBar

-- Otomatik Satın Alma Butonu
local AutoBuyButton = Instance.new("TextButton")
AutoBuyButton.Name = "AutoBuyButton"
AutoBuyButton.Size = UDim2.new(0, 240, 0, 35)
AutoBuyButton.Position = UDim2.new(0.5, -120, 0, 45)
AutoBuyButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50) -- Kapalı rengi (Kırmızı)
AutoBuyButton.Font = Enum.Font.SourceSansBold
AutoBuyButton.Text = "Otomatik Alım: KAPALI"
AutoBuyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoBuyButton.TextSize = 16
AutoBuyButton.Parent = MainFrame

local UICorner_AutoBuy = Instance.new("UICorner")
UICorner_AutoBuy.CornerRadius = UDim.new(0, 6)
UICorner_AutoBuy.Parent = AutoBuyButton

-- Hız Sıfırlama Butonu
local ResetSpeedButton = Instance.new("TextButton")
ResetSpeedButton.Name = "ResetSpeedButton"
ResetSpeedButton.Size = UDim2.new(0, 115, 0, 30)
ResetSpeedButton.Position = UDim2.new(0.5, 5, 0, 135)
ResetSpeedButton.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
ResetSpeedButton.Font = Enum.Font.SourceSans
ResetSpeedButton.Text = "Hızı Sıfırla"
ResetSpeedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResetSpeedButton.TextSize = 14
ResetSpeedButton.Parent = MainFrame

local UICorner_Reset = Instance.new("UICorner")
UICorner_Reset.CornerRadius = UDim.new(0, 6)
UICorner_Reset.Parent = ResetSpeedButton

-- Hız Ayarı için Özel Slider
local SpeedSliderLabel = Instance.new("TextLabel")
SpeedSliderLabel.Name = "SpeedSliderLabel"
SpeedSliderLabel.Size = UDim2.new(1, -20, 0, 20)
SpeedSliderLabel.Position = UDim2.new(0, 10, 0, 90)
SpeedSliderLabel.Text = "Hız: 16"
SpeedSliderLabel.Font = Enum.Font.SourceSans
SpeedSliderLabel.TextSize = 14
SpeedSliderLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
SpeedSliderLabel.BackgroundTransparency = 1
SpeedSliderLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedSliderLabel.Parent = MainFrame

local SliderBackground = Instance.new("Frame")
SliderBackground.Name = "SliderBackground"
SliderBackground.Size = UDim2.new(0, 240, 0, 10)
SliderBackground.Position = UDim2.new(0.5, -120, 0, 110)
SliderBackground.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
SliderBackground.Parent = MainFrame

local UICorner_SliderBg = Instance.new("UICorner")
UICorner_SliderBg.Parent = SliderBackground

local SliderHandle = Instance.new("TextButton")
SliderHandle.Name = "SliderHandle"
SliderHandle.Size = UDim2.new(0, 20, 0, 20)
SliderHandle.Position = UDim2.new(0, -10, 0.5, -10)
SliderHandle.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
SliderHandle.BorderSizePixel = 0
SliderHandle.Draggable = false
SliderHandle.Text = ""
SliderHandle.Parent = SliderBackground

local UICorner_Handle = Instance.new("UICorner")
UICorner_Handle.Parent = SliderHandle

-- GUI'yi Gizle/Göster Butonu
local ToggleVisibilityButton = Instance.new("TextButton")
ToggleVisibilityButton.Name = "ToggleVisibilityButton"
ToggleVisibilityButton.Size = UDim2.new(0, 80, 0, 30)
ToggleVisibilityButton.Position = UDim2.new(0, 10, 0.5, 0)
ToggleVisibilityButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ToggleVisibilityButton.BackgroundTransparency = 0.4
ToggleVisibilityButton.Font = Enum.Font.SourceSansBold
ToggleVisibilityButton.Text = "Gizle"
ToggleVisibilityButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleVisibilityButton.TextSize = 14
ToggleVisibilityButton.Draggable = true
ToggleVisibilityButton.Active = true
ToggleVisibilityButton.Parent = ScreenGui

local UICorner_Toggle = Instance.new("UICorner")
UICorner_Toggle.CornerRadius = UDim.new(0, 8)
UICorner_Toggle.Parent = ToggleVisibilityButton

--================================================================
-- 2. ADIM: GUI FONKSİYONLARINI VE MANTIĞINI BAĞLAMA
--================================================================

-- Otomatik alım butonuna tıklandığında...
AutoBuyButton.MouseButton1Click:Connect(function()
    _G.AutoBuyTreats = not _G.AutoBuyTreats
    if _G.AutoBuyTreats then
        AutoBuyButton.Text = "Otomatik Alım: AÇIK"
        AutoBuyButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50) -- Açık rengi (Yeşil)
    else
        AutoBuyButton.Text = "Otomatik Alım: KAPALI"
        AutoBuyButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50) -- Kapalı rengi (Kırmızı)
    end
end)

-- Slider'ın görselini ve değerini güncelleyen fonksiyon
local function UpdateSlider(value)
    local min, max = 16, 150
    local percentage = (value - min) / (max - min)
    SliderHandle.Position = UDim2.new(percentage, -10, 0.5, -10)
    _G.WalkSpeed = value
    SpeedSliderLabel.Text = "Hız: " .. math.floor(value)
end

-- Hızı sıfırla butonuna tıklandığında...
ResetSpeedButton.MouseButton1Click:Connect(function()
    UpdateSlider(16)
end)

-- Slider'ı sürükleme mantığı
local isDragging = false
SliderHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = true
    end
end)

SliderHandle.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local mouseX = input.Position.X
        local startX = SliderBackground.AbsolutePosition.X
        local width = SliderBackground.AbsoluteSize.X
        local percentage = math.clamp((mouseX - startX) / width, 0, 1)
        
        local min, max = 16, 150
        local newValue = min + (max - min) * percentage
        UpdateSlider(newValue)
    end
end)


-- GUI Gizleme/Gösterme Butonu
ToggleVisibilityButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
    if MainFrame.Visible then
        ToggleVisibilityButton.Text = "Gizle"
    else
        ToggleVisibilityButton.Text = "Göster"
    end
end)

--================================================================
-- 3. ADIM: OYUN İÇİ MANTIK
--================================================================

-- Hız değiştirme döngüsü
task.spawn(function()
    while task.wait(0.2) do
        pcall(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.WalkSpeed = _G.WalkSpeed
            end
        end)
    end
end)

-- Satın alınacak meyvelerin listesi
local fruitsToBuy = {"Carrot", "Apple", "Corn", "Pepper", "Banana", "Cherries"}

-- Event'leri güvenli bir şekilde bekliyoruz
local RemoteEvents = ReplicatedStorage:WaitForChild("Remote_Events", 10)
if RemoteEvents then
    local RestockEvent = RemoteEvents:WaitForChild("NOT", 5)
    local BuyTreatEvent = RemoteEvents:WaitForChild("Buy_Treat", 5)

    if RestockEvent and BuyTreatEvent then
        -- Restock eventi tetiklendiğinde...
        RestockEvent.OnClientEvent:Connect(function(message)
            if message == "The treat shop has been restocked!" then
                if _G.AutoBuyTreats then
                    print("Market yenilendi, otomatik alım başladı...")
                    for _, fruitName in ipairs(fruitsToBuy) do
                        pcall(function()
                            BuyTreatEvent:FireServer(fruitName)
                        end)
                        task.wait(0.2)
                    end
                    print("Tüm meyveler alındı.")
                end
            end
        end)
        print("Otomatik Market eventi başarıyla bağlandı.")
    else
        warn("Satın alma veya restock eventi bulunamadı!")
    end
else
    warn("Remote_Events klasörü bulunamadı!")
end

print("Özel kodlanmış Lasso Animals Script'i yüklendi.")
